<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>multiHiCcompare Vignette • multiHiCcompare</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="multiHiCcompare Vignette">
<meta property="og:description" content="multiHiCcompare">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multiHiCcompare</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/multiHiCcompare.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/juiceboxVisualization.html">Visualizing multiHiCcompare results in Juicebox</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dozmorovlab/multiHiCcompare/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multiHiCcompare_files/header-attrs-2.5/header-attrs.js"></script><link href="multiHiCcompare_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="multiHiCcompare_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>multiHiCcompare Vignette</h1>
                        <h4 class="author">John C. Stansfield &amp; Mikhail G. Dozmorov</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dozmorovlab/multiHiCcompare/blob/master/vignettes/multiHiCcompare.Rmd"><code>vignettes/multiHiCcompare.Rmd</code></a></small>
      <div class="hidden name"><code>multiHiCcompare.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>multiHiCcompare</code> is an extension of the original <code>HiCcompare</code> package. It provides functions for the joint normalization and detection of differential chromatin interactions between multiple Hi-C datasets. <code>multiHiCcompare</code> operates on processed Hi-C data in the form of chromosome-specific chromatin interaction matrices. It accepts four-column tab-separated text files storing chromatin interaction matrices in a sparse matrix format (see <a href="#hicexp">Creating the hicexp object</a>). Functions to convert popular Hi-C data formats (<code>.hic</code>, <code>.cool</code>) to sparse format are available (see <code>?cooleHCT116_r2sparse</code>, and the examples below). <code>multiHiCcompare</code> differs from other packages that attempt to compare Hi-C data in that it works on processed data in chromatin interaction matrix format instead of raw sequencing data. In addition, <code>multiHiCcompare</code> provides a non-parametric method for the joint normalization and removal of biases between multiple Hi-C datasets for comparative analysis. <code>multiHiCcompare</code> also provides a general linear model (GLM) based framework for detecting differences in Hi-C data.</p>
</div>
<div id="how-to-use-multihiccompare" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-use-multihiccompare" class="anchor"></a>How to use <code>multiHiCcompare</code>
</h1>
<div id="install-multihiccompare-from-bioconductor" class="section level2">
<h2 class="hasAnchor">
<a href="#install-multihiccompare-from-bioconductor" class="anchor"></a>Install <code>multiHiCcompare</code> from Bioconductor</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">"multiHiCcompare"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dozmorovlab/multiHiCcompare">multiHiCcompare</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-hi-c-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-hi-c-data" class="anchor"></a>Getting Hi-C Data</h2>
<p>You will need processed Hi-C data in the form of sparse upper triangular matrices or BEDPE files to use <code>multiHiCcompare</code>. Data is available from several sources and two examples for downloading and extracting data are listed below. If you have full Hi-C contact matrices, you can convert them to sparse upper triangular format using the full <code>full2sparse</code> function as shown in <a href="#addfunc">additional functions</a></p>
<div id="extracting-data-from--hic-files" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-data-from--hic-files" class="anchor"></a>Extracting data from <code>.hic</code> files</h3>
<p>Hi-C data is available from several sources and in many formats. <code>multiHiCcompare</code> is built to work with the sparse upper triangular matrix format popularized by the lab of Erez Lieberman-Aiden <a href="http://aidenlab.org/data.html">http://aidenlab.org/data.html</a>. If you already have Hi-C data either in the form of a sparse upper triangular matrix or a full contact matrix you can skip to the creating the <code>hicexp</code> object section. If you obtain data from the Aiden Lab in the <code>.hic</code> format you will need to first extract the matrices that you wish to compare.</p>
<ol style="list-style-type: decimal">
<li>Download the <code>straw</code> software from <a href="https://github.com/theaidenlab/straw/wiki">https://github.com/theaidenlab/straw/wiki</a> and install it.</li>
<li>Use <code>straw</code> to extract a Hi-C sparse upper triangular matrix. An example is below:</li>
</ol>
<p>Say we downloaded and uncompressed the <code>GSE63525_K562_combined_30.hic</code> file from GEO <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE63525">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE63525</a>, direct link <a href="ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE63nnn/GSE63525/suppl/GSE63525_K562_combined_30.hic.gz">ftp</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE63525&amp;format=file&amp;file=GSE63525%5FK562%5Fcombined%5F30%2Ehic%2Egz">http</a></p>
<p>To extract the raw matrix corresponding to chromosome 22 at the 500kb resolution we would use the following command within the terminal</p>
<p><code>./straw NONE GSE63525_K562_combined_30.hic  22 22 BP 500000 &gt; K562.chHCT116_r22.500kb.txt</code></p>
<p>This will extract the matrix from the <code>.hic</code> file and save it to the <code>K562.chHCT116_r22.500kb.txt</code> text file, in the sparse upper triangular matrix format. See more examples on how to use <code>straw</code> at <a href="https://github.com/theaidenlab/straw/wiki/CPP#running">https://github.com/theaidenlab/straw/wiki/CPP#running</a>. Straw requires several inputs for the extraction of data from a <code>.hic</code> file.</p>
<p><code>&lt;NONE/VC/VC_SQRT/KR&gt; &lt;hicFile(s)&gt; &lt;chr1&gt;[:x1:x2] &lt;chr2&gt;[:y1:y2] &lt;BP/FRAG&gt; &lt;binsize&gt;</code></p>
<p>The first argument is the normalization method. For use in <code>multiHiCcompare</code> you want the raw data so you should select <code>NONE</code>. The second argument is the <code>.hic</code> file name. Next is the chromosome numbers of the matrix you want. For an intrachromosomal contact map, both should be the same as in the above example. If you want a matrix of interchromosomal interactions, you can use different chromosomes, i.e. interactions between chromosome 1 and chromosome 2 (Note that <code>HiCcompare</code> is only meant to be used on intrachromosomal interactions at this point in development). The next argument is whether you want basepair or fragment files. For <code>multiHiCcompare</code> use <code>BP</code>. The final argument is the bin size of the matrix (the resolution). To extract a matrix at a resolution of 1MB enter <code>10000000</code>. Typical bin sizes are 1MB, 500KB, 100KB, 50KB, 5KB, 1KB. Note that most matrices with resolutions higher than 100KB (i.e., matrices with resolutions of 1KB - 50KB) are typically too sparse (due to insufficient sequencing coverage) for analysis in <code>multiHiCcompare</code>.</p>
<p>From here we can import the matrix into R as you would normally for any tab-delimited file.</p>
<ol start="3" style="list-style-type: decimal">
<li>Import the data into R <code>K562.chr22 &lt;- read.table('K562.chr22.500kb.txt', header=FALSE)</code>
</li>
<li>Repeat these steps for any other Hi-C dataset that you wish to compare to the first dataset using <code>multiHiCcompare</code>.</li>
</ol>
</div>
<div id="extracting-data-from--cool-files" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-data-from--cool-files" class="anchor"></a>Extracting data from <code>.cool</code> files</h3>
<p>The <code>cooler</code> software, <a href="http://cooler.readthedocs.io/en/latest/index.html">http://cooler.readthedocs.io/en/latest/index.html</a>, allows access to a large collection of Hi-C data. The cooler index <a href="ftp://cooler.csail.mit.edu/coolers">ftp://cooler.csail.mit.edu/coolers</a> contains Hi-C data for <code>hg19</code> and <code>mm9</code> from many different sources. To use data in the <code>.cool</code> format in <code>HiCcompare</code> follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Download and install <code>cooler</code> from <a href="http://cooler.readthedocs.io/en/latest/index.html">http://cooler.readthedocs.io/en/latest/index.html</a>
</li>
<li>Download a <code>.cool</code> file from the cooler index <a href="ftp://cooler.csail.mit.edu/coolers">ftp://cooler.csail.mit.edu/coolers</a>.</li>
<li>Say we downloaded the <code>Dixon2012-H1hESC-HindIII-allreps-filtered.1000kb.cool</code> file. See <code>cooler dump --help</code> for data extraction options. To extract the contact matrix we use the following commands in the terminal:<br><code>cooler dump --join Dixon2012-H1hESC-HindIII-allreps-filtered.1000kb.cool &gt; dixon.hESC.1000kb.txt</code>
</li>
<li>Read in the text file as you would any tab-delimited file in R<br><code>hesc1000kb &lt;- read.table("dixon.hESC.1000kb.txt", header = FALSE)</code>
</li>
<li>Convert to a sparse upper triangular matrix using the <code><a href="https://rdrr.io/pkg/HiCcompare/man/cooler2sparse.html">HiCcompare::cooler2sparse</a></code> function.<br><code>sparse &lt;- cooler2sparse(hesc1000kb)</code>
</li>
<li>Repeat the steps for another Hi-C dataset that you wish to compare to the first dataset.</li>
</ol>
</div>
<div id="using-data-from-hic-pro" class="section level3">
<h3 class="hasAnchor">
<a href="#using-data-from-hic-pro" class="anchor"></a>Using data from HiC-Pro</h3>
<p>HiC-Pro is another tool for processing raw Hi-C data into usable matrix files. HiC-Pro will produce a <code>.matrix</code> file and a <code>.bed</code> file for the data. These <code>.matrix</code> files are in a sparse upper triangular format similar to the results of Juicer and the dumped contents of a <code>.hic</code> file, however instead of using the genomic start coordinates for the first two columns of the sparse matrix they use an ID number. The <code>.bed</code> file contains the mappings for each of these IDs to their genomic coordinates. The original <code>HiCcompare</code> package includes a function to convert the results of HiC-Pro into a usable format for analysis in <code>multiHiCcompare</code>. When using data from HiC-Pro, it is important to use the raw <code>.matrix</code> files and NOT the iced <code>.matrix</code> files. The iced <code>.matrix</code> files have already had ICE normalization applied to them and are not suitable for entry into <code>multiHiCcompare</code>. Here we convert HiC-Pro data for input into <code>multiHiCcompare</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in files</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"hic_1000000.matrix"</span><span class="op">)</span>
<span class="va">bed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"hic_1000000_abs.bed"</span><span class="op">)</span>
<span class="co"># convert to BEDPE</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">HiCcompare</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HiCcompare/man/hicpro2bedpe.html">hicpro2bedpe</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">bed</span><span class="op">)</span>
<span class="co"># NOTE: hicpro2bedpe returns a list of lists. </span>
<span class="co">#   The first list, dat$cis, contains the intrachromosomal contact matrices</span>
<span class="co"># NOTE: dat$trans contains the interchromosomal </span>
<span class="co">#   contact matrix which is not used in multiHiCcompare.</span></code></pre></div>
<p>See the help using <code><a href="https://rdrr.io/pkg/HiCcompare/man/hicpro2bedpe.html">?HiCcompare::hicpro2bedpe</a></code> for more details.</p>
</div>
</div>
<div id="parallel-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-processing" class="anchor"></a>Parallel Processing</h2>
<p>Hi-C data is large, especially at high resolutions, and loess normalization is computationally intensive. <code>multiHiCcompare</code> was built with parallelization in mind and the best performance when working with large Hi-C experiments (many samples or high resolution) will be achieved when using a computing cluster. Parallel processing can be used for all normalization and comparison functions by setting <code>parallel = TRUE</code> in the function options. <code>multiHiCcompare</code> uses the Bioconductor <code>BiocParallel</code> package for parallel processing. You can set the number of processors to use on Linux with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel">BiocParallel</a></span><span class="op">)</span>
<span class="va">numCores</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html">MulticoreParam</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="va">numCores</span><span class="op">)</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Or on Windows with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel">BiocParallel</a></span><span class="op">)</span>
<span class="va">numCores</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="va">numCores</span><span class="op">)</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>where <code>numCores</code> is the user-set number of processing cores to be used. For parallel processing in <code>multiHiCcompare</code>, jobs are split by chromosome and sometimes distance thus the more processors used, the quicker the function will run. For maximum speed, it is recommended to set <code>numCores</code> to the maximum number of processors available.</p>
</div>
<div id="hicexp" class="section level2">
<h2 class="hasAnchor">
<a href="#hicexp" class="anchor"></a>Creating the <code>hicexp</code> object</h2>
<div id="sparse-upper-triangular-format" class="section level3">
<h3 class="hasAnchor">
<a href="#sparse-upper-triangular-format" class="anchor"></a>Sparse upper triangular format</h3>
<p>A sparse matrix format represents a relatively compact and human-readable way to store pair-wise interactions. It is a tab-delimited text format containing three columns: “region1” - a start coordinate (in bp) of the first region, “region2” a start coordinate of the second region, and “IF” - the interaction frequency between them (IFs). Zero IFs are dropped (hence, the <em>sparse</em> format). Since the full matrix of chromatin interactions is symmetric, only the upper triangular portion, including the diagonal, is stored. Typically matrices in this format are stored in separate text files for each chromosome. For use in <code>multiHiCcompare</code>, you will need to add a column for the chromosome number. The chromosome number should be entered as just the number. Chromosomes such as X, Y, etc. should be entered as 23, 24, etc. If you are planning to analyze data for more than a single chromosome, you will need to concatenate these matrices together. A sparse Hi-C matrix ready to be input into <code>multiHiCcompare</code> should look like the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HCT116_r1"</span><span class="op">)</span> <span class="co"># load example sparse matrix</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">HCT116_r1</span><span class="op">)</span>
<span class="co">#&gt;   "22"       V1       V2 V3</span>
<span class="co">#&gt; 1   22 16000000 16000000 11</span>
<span class="co">#&gt; 2   22 16100000 16100000  1</span>
<span class="co">#&gt; 3   22 16200000 16200000  3</span>
<span class="co">#&gt; 4   22 16300000 16300000 15</span>
<span class="co">#&gt; 5   22 16400000 16400000  3</span>
<span class="co">#&gt; 6   22 16400000 16500000  1</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">HCT116_r1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'chr'</span>, <span class="st">'region1'</span>, <span class="st">'region2'</span>, <span class="st">'IF'</span><span class="op">)</span> <span class="co"># rename columns</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">HCT116_r1</span><span class="op">)</span> <span class="co"># matrix ready to be input into multiHiCcompare</span>
<span class="co">#&gt;   chr  region1  region2 IF</span>
<span class="co">#&gt; 1  22 16000000 16000000 11</span>
<span class="co">#&gt; 2  22 16100000 16100000  1</span>
<span class="co">#&gt; 3  22 16200000 16200000  3</span>
<span class="co">#&gt; 4  22 16300000 16300000 15</span>
<span class="co">#&gt; 5  22 16400000 16400000  3</span>
<span class="co">#&gt; 6  22 16400000 16500000  1</span></code></pre></div>
<p>If you have full Hi-C contact matrices you can convert them to sparse upper triangular matrices using the <code><a href="https://rdrr.io/pkg/HiCcompare/man/full2sparse.html">HiCcompare::full2sparse</a></code> function and then add a column indicating the chromosome.</p>
<p>Say we have data from 2 experimental conditions with 2 samples each. We can make a <code>hicexp</code> object by doing the following.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HCT116_r1"</span>, <span class="st">"HCT116_r2"</span>, <span class="st">"HCT116_r3"</span>, <span class="st">"HCT116_r4"</span><span class="op">)</span>
<span class="va">hicexp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_hicexp.html">make_hicexp</a></span><span class="op">(</span><span class="va">HCT116_r1</span>, <span class="va">HCT116_r2</span>, <span class="va">HCT116_r3</span>, <span class="va">HCT116_r4</span>, 
                       groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, 
                       zero.p <span class="op">=</span> <span class="fl">0.8</span>, A.min <span class="op">=</span> <span class="fl">5</span>, filter <span class="op">=</span> <span class="cn">TRUE</span>,
                       remove.regions <span class="op">=</span> <span class="va">hg19_cyto</span><span class="op">)</span>
<span class="va">hicexp1</span>
<span class="co">#&gt; Hi-C Experiment Object </span>
<span class="co">#&gt; 2 experimental groups </span>
<span class="co">#&gt; Group 1 has 2 samples </span>
<span class="co">#&gt; Group 2 has 2 samples</span></code></pre></div>
<p>The <code>groups</code> option specifies the experimental groups. You must enter a vector the length of the number of Hi-C matrices with indicators for which group each matrix belongs to. An optional covariate <code>data.frame</code> with rows corresponding the Hi-C matrices and columns for each additional covariate can be provided with the <code>covariates</code> option.</p>
<p>Filtering can be performed when creating a <code>hicexp</code> object using the <code>zero.p</code> and <code>A.min</code> options in the <code>make_hicexp</code> function. The <code>zero.p</code> option allows for filtering by the proportion of zero IFs for an interaction. The <code>A.min</code> allows for filtering by a minimum average IF value. These options can be used together or individually to filter your data. Filtering is important to remove interactions with lots of 0 IFs and low average expression. These interactions tend to not be very interesting and can easily become a false positive during difference detection. Additionally, removing these interactions will increase the computational speed of <code>multiHiCcompare</code>. If for some reason you do not want to filter the data simply set <code>filter = FALSE</code>.</p>
<p>Additionally, you can filter out specific genomic regions such as centromeres or blacklisted regions. <code>multiHiCcompare</code> comes with built-in regions to be filtered for hg19 and hg38 which can be accessed like so.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"hg19_cyto"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"hg38_cyto"</span><span class="op">)</span>

<span class="va">hg19_cyto</span>
<span class="co">#&gt; GRanges object with 70 ranges and 2 metadata columns:</span>
<span class="co">#&gt;        seqnames              ranges strand |      arm  feature</span>
<span class="co">#&gt;           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;factor&gt; &lt;factor&gt;</span>
<span class="co">#&gt;    [1]        1 121500000-125000000      * |    p11.1     acen</span>
<span class="co">#&gt;    [2]        1 125000000-128900000      * |    q11       acen</span>
<span class="co">#&gt;    [3]        1 128900000-142600000      * |    q12       gvar</span>
<span class="co">#&gt;    [4]       10   38000000-40200000      * |    p11.1     acen</span>
<span class="co">#&gt;    [5]       10   40200000-42300000      * |    q11.1     acen</span>
<span class="co">#&gt;    ...      ...                 ...    ... .      ...      ...</span>
<span class="co">#&gt;   [66]       23   58100000-60600000      * |    p11.1     acen</span>
<span class="co">#&gt;   [67]       23   60600000-63000000      * |    q11.1     acen</span>
<span class="co">#&gt;   [68]       24   11600000-12500000      * |    p11.1     acen</span>
<span class="co">#&gt;   [69]       24   12500000-13400000      * |    q11.1     acen</span>
<span class="co">#&gt;   [70]       24   28800000-59373566      * |    q12       gvar</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 24 sequences from an unspecified genome; no seqlengths</span></code></pre></div>
<p>By default, the <code>make_hicexp</code> object will have the <code>remove.regions</code> option set to use the <code>hg19_cyto</code> object. If your data was not aligned to hg19 or you want other regions to be removed, you can create a <code>GenomicRanges</code> object containing the ranges to be removed and the <code>remove.regions</code> option to this object.</p>
</div>
<div id="the-hicexp-object" class="section level3">
<h3 class="hasAnchor">
<a href="#the-hicexp-object" class="anchor"></a>The <code>hicexp</code> object</h3>
<p>The <code>hicexp</code> S4 class has several slots which can be accessed with the accessor functions <code><a href="../reference/hic_table.html">hic_table()</a></code>, <code><a href="../reference/results.html">results()</a></code>, and <code><a href="../reference/meta.html">meta()</a></code>. The <code>hic_table</code> slot contains the Hi-C matrix in sparse format. The first four columns are the chromosome, region1 start location, region2 start location, and unit distance. All following chromosomes represent the IFs for that interacting pair from each sample. The <code>comparison</code> slot is empty at creation but will be filled following use of one of the comparison functions. It contains the same first four columns as the <code>hic_table</code> slot, but also has the logFC - log fold change between conditions, logCPM - log counts per million, p.value, and p.adj - multiple testing corrected p-value columns which indicate the significance of the difference for each interacting pair of regions between the conditions. Access the <code>comparison</code> slot using <code><a href="../reference/results.html">results()</a></code>. The <code>metadata</code> slot contains the <code>data.frame</code> of covariates for the experiment. Access the <code>metadata</code> slot by using <code><a href="../reference/meta.html">meta()</a></code>. The other slots are mainly for internal use, and the typical user does not need to be concerned with them.</p>
</div>
</div>
<div id="normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#normalization" class="anchor"></a>Normalization</h2>
<p><code>multiHiCcompare</code> comes with a few methods for normalizing your Hi-C data. Our joint normalization methods are again based on the MD plot as in the original <code>HiCcompare</code>. The MD plot is similar to the MA plot or the Bland-Altman plot. <span class="math inline">\(M\)</span> is the <span class="math inline">\(log2\)</span> difference between the interaction frequencies from the two datasets. <span class="math inline">\(D\)</span> is the unit distance between the two interacting regions. Loess is performed on the data after it is represented in the MD coordinate system.</p>
<div id="library-scaling" class="section level3">
<h3 class="hasAnchor">
<a href="#library-scaling" class="anchor"></a>Library scaling</h3>
<p>The simplest form of normalization to compare Hi-C data is library scaling. <code>multiHiCcompare</code> provides the <code><a href="../reference/hic_scale.html">hic_scale()</a></code> function to scale the Hi-C libraries from each sample to the size of the smallest library. If you believe that any trends present in your data are important differences and not due to bias, then you can use library scaling for normalizing your data as follows.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"hicexp2"</span><span class="op">)</span>
<span class="va">hicexp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_scale.html">hic_scale</a></span><span class="op">(</span><span class="va">hicexp2</span><span class="op">)</span></code></pre></div>
<p>Note that you need to use either simple scaling or loess normalization method. It is recommended to use either cyclic loess or fast loess that will implicitly rescale the libraries and remove unwanted trends.</p>
</div>
<div id="cyclic-loess-normalization" class="section level3">
<h3 class="hasAnchor">
<a href="#cyclic-loess-normalization" class="anchor"></a>Cyclic Loess Normalization</h3>
<p><code>multiHiCcompare</code> provides a cyclic loess method for the joint normalization of multiple Hi-C datasets. The method is based on representing the data on an MD plot. The MD plot is similar to the MA plot (Bland-Altman plot) which is commonly used for the visualization of gene expression differences. <span class="math inline">\(M\)</span> is defined as the log difference between the two data sets <span class="math inline">\(M = log_2(IF_2/IF_1)\)</span>, where <span class="math inline">\(IF_1\)</span> and <span class="math inline">\(IF_2\)</span> are interaction frequencies of the first and the second Hi-C datasets, respectively. <span class="math inline">\(D\)</span> is defined as the distance between two interacting regions, expressed in unit-length of the <span class="math inline">\(X\)</span> resolution of the Hi-C data. A loess regression curve is fit through the MD plot and used to remove global biases by centering the <span class="math inline">\(M\)</span> differences around <span class="math inline">\(M=0\)</span> baseline.</p>
<p>The cyclic loess algorithm proceeds through the following steps.</p>
<ol style="list-style-type: decimal">
<li>Choose two out of the <span class="math inline">\(N\)</span> total samples then generate an MD plot.</li>
<li>Fit a loess curve <span class="math inline">\(f(d)\)</span> to the MD plot.</li>
<li>Subtract <span class="math inline">\(f(d)/2\)</span> from the first dataset and add <span class="math inline">\(f(d)/2\)</span> to the second.</li>
<li>Repeat until all unique pairs have been compared.</li>
<li>Repeat until convergence.</li>
</ol>
<p>To perform cyclic loess on your Hi-C data you will need to use the <code><a href="../reference/cyclic_loess.html">cyclic_loess()</a></code> function as shown below:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hicexp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyclic_loess.html">cyclic_loess</a></span><span class="op">(</span><span class="va">hicexp1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, 
                        parallel <span class="op">=</span> <span class="cn">FALSE</span>, span <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="co"># make MD plot</span>
<span class="fu"><a href="../reference/MD_hicexp.html">MD_hicexp</a></span><span class="op">(</span><span class="va">hicexp1</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>As can be seen in the above MD plots, the data for each sample has been jointly normalized with all other samples. Note that the user can set the span option. A user-set span will run quicker than the default option of automatically calculating the span. It is best to use the automatic span calculation if you have not worked with the data before, but if you are familiar with it then setting the span is a way to speed up processing. The <code>hic_table</code> slot in the <code>hicexp</code> object has also been updated with the normalized IFs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/hic_table.html">hic_table</a></span><span class="op">(</span><span class="va">hicexp1</span><span class="op">)</span>
<span class="co">#&gt;        chr  region1  region2 D        IF1        IF2        IF3        IF4</span>
<span class="co">#&gt;     1:  22 18000000 18000000 0 4848.93586 5117.56104 5757.67702 4330.37698</span>
<span class="co">#&gt;     2:  22 18000000 18100000 1 1307.53629 1128.57032 1317.91263  893.55501</span>
<span class="co">#&gt;     3:  22 18000000 18200000 2  715.99832  734.05089  729.32691  743.67190</span>
<span class="co">#&gt;     4:  22 18000000 18300000 3  352.17410  409.94247  420.22430  387.50225</span>
<span class="co">#&gt;     5:  22 18000000 18400000 4  296.77137  274.80602  306.21630  314.82774</span>
<span class="co">#&gt;    ---                                                                    </span>
<span class="co">#&gt; 43740:  22 51000000 51100000 1 1622.03802 1762.87853 1664.49400 1271.16626</span>
<span class="co">#&gt; 43741:  22 51000000 51200000 2   30.51641   35.06727   31.06704   22.70308</span>
<span class="co">#&gt; 43742:  22 51100000 51100000 0 3681.72778 4131.14202 4126.33930 3604.34388</span>
<span class="co">#&gt; 43743:  22 51100000 51200000 1   79.15003   63.50592   77.51615   57.56003</span>
<span class="co">#&gt; 43744:  22 51200000 51200000 0   17.19701   25.33298   28.78896   36.23247</span></code></pre></div>
<p>The runtime of cyclic loess can be decreased when multiple processors are available by setting the <code>parallel</code> option to <code>TRUE</code>. This option splits up the data by chromosome and sends each chromosome’s data to a parallel processor.</p>
</div>
<div id="fast-loess-normalization-fastlo" class="section level3">
<h3 class="hasAnchor">
<a href="#fast-loess-normalization-fastlo" class="anchor"></a>Fast Loess Normalization (Fastlo)</h3>
<p>In addition to the standard cyclic loess method, <code>multiHiCcompare</code> also implements the Fast Loess (Fastlo) joint normalization algorithm. Our implementation of fastlo is adapted to Hi-C data on a per-distance basis. To perform “fastlo” on Hi-C data we first split the data into <span class="math inline">\(p\)</span> pooled matrices. The “progressive pooling” is used to split up the Hi-C matrix by unit distance such that distance 0 is its own pool, distances 1 and 2 are pooled, distance 3, 4, 5 are pooled, and so on until all unit distances belong to one of <span class="math inline">\(p\)</span> pools. Each matrix will have an <span class="math inline">\(IF_{gj}\)</span> value with <span class="math inline">\(g\)</span> interacting pairs for each of the <span class="math inline">\(j\)</span> samples. These <span class="math inline">\(p\)</span> matrices can then be input into the “fastlo” algorithm using the following steps.</p>
<ol style="list-style-type: decimal">
<li>Create the vector <span class="math inline">\(\hat{IF}_{pgj}\)</span>, the row means of the <span class="math inline">\(p^{th}\)</span> matrix. This is the equivalent of creating an average IF at distance pool <span class="math inline">\(p\)</span>.</li>
<li>Plot <span class="math inline">\(\hat{IF}_{p}\)</span> versus <span class="math inline">\((IF_{pg} - \hat{IF_p})\)</span> for each sample <span class="math inline">\(j\)</span>. This is equivalent to an MA plot at a genomic distance pool <span class="math inline">\(p\)</span>.</li>
<li>Fit a loess curve <span class="math inline">\(f(x)\)</span> to the plot.</li>
<li>Subtract <span class="math inline">\(f(x)\)</span> from sample <span class="math inline">\(j\)</span>.</li>
<li>Repeat for all remaining replicates.</li>
<li>Repeat until algorithm converges.</li>
</ol>
<p>You can perform fastlo normalization on your data as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"hicexp2"</span><span class="op">)</span>
<span class="co"># perform fastlo normalization</span>
<span class="va">hicexp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fastlo.html">fastlo</a></span><span class="op">(</span><span class="va">hicexp2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># make MD plot</span>
<span class="fu"><a href="../reference/MD_hicexp.html">MD_hicexp</a></span><span class="op">(</span><span class="va">hicexp2</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Again, the above MD plots show the normalized data. <code><a href="../reference/fastlo.html">fastlo()</a></code> can also make use of parallelization to speed up computation speeds by setting the <code>parallel</code> option to <code>TRUE</code>. The results of <code><a href="../reference/fastlo.html">fastlo()</a></code> and <code><a href="../reference/cyclic_loess.html">cyclic_loess()</a></code> may be slightly different, but both should result in the removal of biases between Hi-C datasets. <code><a href="../reference/fastlo.html">fastlo()</a></code> will have quicker run times compared to <code><a href="../reference/cyclic_loess.html">cyclic_loess()</a></code>, but <code><a href="../reference/cyclic_loess.html">cyclic_loess()</a></code> will likely give a slightly better normalization.</p>
</div>
</div>
<div id="difference-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#difference-detection" class="anchor"></a>Difference Detection</h2>
<p><code>multiHiCcompare</code> provides two main ways to perform a differential comparison between the groups or conditions of your Hi-C experiment. For simple experiments where only a comparison between two groups is being made, the <code><a href="../reference/hic_exactTest.html">hic_exactTest()</a></code> function can be used. For more complex experiments with covariates or multiple groups, the <code><a href="../reference/hic_glm.html">hic_glm()</a></code> function should be used. Both of these functions make use of the <code>edgeR</code> package for fitting negative binomial models to the Hi-C data. For the difference detection steps, <code>multiHiCcompare</code> first splits the data up by distance using the progressive pooling described in the fastlo section. Each distance pool is then treated similarly to an independent RNA-seq data matrix on which <code>edgeR</code>’s functions are applied to fit the specified model. This process is illustrated in Figure 1 below.</p>
<p><img src="multiHiCcompare_glm.png"></p>
<p><strong>Figure 1.</strong> The off-diagonal analysis of multiple Hi-C replicates. Dashed lines represent the off-diagonal vectors of interaction frequencies at a given distance between interacting regions. Right: Converted into a matrix format similar to RNA-seq data, IFs can be loess normalized, variance across replicates can be estimated using an empirical Bayes approach, and differences can be detected using log-linear GLMs.</p>
<div id="exact-test" class="section level3">
<h3 class="hasAnchor">
<a href="#exact-test" class="anchor"></a>Exact Test</h3>
<p>For simple Hi-C experiments the <code><a href="../reference/hic_exactTest.html">hic_exactTest()</a></code> function can be used as shown below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hicexp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_exactTest.html">hic_exactTest</a></span><span class="op">(</span><span class="va">hicexp1</span>, p.method <span class="op">=</span> <span class="st">'fdr'</span>, 
                         parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot results</span>
<span class="fu"><a href="../reference/MD_composite.html">MD_composite</a></span><span class="op">(</span><span class="va">hicexp1</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The above composite MD plot displays where any significant differences are detected between the two groups. This function can also be sped up by using the <code>parallel</code> option. The results of the comparison are then saved in the <code>comparison</code> slot of the <code>hicexp</code> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/results.html">results</a></span><span class="op">(</span><span class="va">hicexp1</span><span class="op">)</span>
<span class="co">#&gt;        chr  region1  region2 D        logFC    logCPM    p.value     p.adj</span>
<span class="co">#&gt;     1:  22 18000000 18000000 0 -0.002271489 11.162876 0.98355590 0.9978994</span>
<span class="co">#&gt;     2:  22 18000000 18100000 1 -0.166524611  9.056102 0.24699655 0.6200377</span>
<span class="co">#&gt;     3:  22 18000000 18200000 2  0.014611713  8.394195 0.91509193 0.9704410</span>
<span class="co">#&gt;     4:  22 18000000 18300000 3  0.064067277 10.298587 0.60748736 0.9685625</span>
<span class="co">#&gt;     5:  22 18000000 18400000 4  0.098498828  9.903732 0.45349569 0.9206592</span>
<span class="co">#&gt;    ---                                                                    </span>
<span class="co">#&gt; 43740:  22 51000000 51100000 1 -0.223639527  9.499253 0.07028879 0.3629536</span>
<span class="co">#&gt; 43741:  22 51000000 51200000 2 -0.299777832  3.866202 0.34735616 0.6875078</span>
<span class="co">#&gt; 43742:  22 51100000 51100000 0 -0.027527966 10.798143 0.80184233 0.9212657</span>
<span class="co">#&gt; 43743:  22 51100000 51200000 1 -0.097398299  5.032406 0.69220609 0.8790205</span>
<span class="co">#&gt; 43744:  22 51200000 51200000 0  0.602807182  3.727353 0.08237680 0.3831598</span></code></pre></div>
<p>In this <code>data.table</code> the first 3 columns represent the identity of the interaction, then followed by the unit genomic distance (<code>D</code>), the log fold change difference between the groups (<code>logFC</code>), the log counts per million for the interaction (<code>logCPM</code>), the p-value and finally the multiple testing correction p-value (<code>p.adj</code>). The type of multiple testing applied can be changed using the <code>p.method</code> option. To view what other adjustment methods are available look at the help for <code><a href="https://rdrr.io/r/stats/p.adjust.html">?p.adjust</a></code>.</p>
</div>
<div id="glm-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#glm-methods" class="anchor"></a>GLM Methods</h3>
<p>For more complex Hi-C experiments the <code><a href="../reference/hic_glm.html">hic_glm()</a></code> function must be used. To use this function, a design matrix must first be created. Here use the <code>hicexp2</code> object with some covariates and create the design matrix.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>
<span class="co"># produce design matrix</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="../reference/meta.html">meta</a></span><span class="op">(</span><span class="va">hicexp2</span><span class="op">)</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The design matrix should contain the covariates of interest. Any categorical variables should be entered as factors. Next, the comparison of interest will need to be specified using either the <code>contrast</code> or the <code>coef</code> option. For this example we are interested in the group difference thus we can set <code>coef = 2</code> to test if the group effect is equal to 0. For more information on using <code>contrast</code> and <code>coef</code> please see the <code>edgeR</code> user manual. Now we are ready to perform the comparison.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hicexp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_glm.html">hic_glm</a></span><span class="op">(</span><span class="va">hicexp2</span>, design <span class="op">=</span> <span class="va">d</span>, coef <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"QLFTest"</span>, p.method <span class="op">=</span> <span class="st">"fdr"</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>There are three methods by which <code><a href="../reference/hic_glm.html">hic_glm()</a></code> can be performed. The default method is to the use the <code>QLFTest</code> which makes use of the quasi-likelihood model. Additionally, there is the <code>LRTest</code> which conducts a likelihood ratio test. The final method is the <code>Treat</code> method which conducts a test relative to a specified fold change threshold. For this option, the <code>M</code> option will need to be used to specify the log2 fold change threshold.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use Treat option</span>
<span class="va">hicexp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_glm.html">hic_glm</a></span><span class="op">(</span><span class="va">hicexp2</span>, design <span class="op">=</span> <span class="va">d</span>, coef <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"Treat"</span>, 
                  M <span class="op">=</span> <span class="fl">0.5</span>, p.method <span class="op">=</span> <span class="st">"fdr"</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="downstream-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#downstream-analysis" class="anchor"></a>Downstream analysis</h2>
<p>For downstream analysis of the results of <code>multiHiCcompare</code>, you may want to filter the results. This can be accomplished by using the <code>topDirs</code> function. Setting the <code>return_df = 'pairedbed'</code> will return a table of the interacting pairs filtered by your specifications.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topDirs.html">topDirs</a></span><span class="op">(</span><span class="va">hicexp1</span>, logfc_cutoff <span class="op">=</span> <span class="fl">0.5</span>, logcpm_cutoff <span class="op">=</span> <span class="fl">0.5</span>,
        p.adj_cutoff <span class="op">=</span> <span class="fl">0.2</span>, return_df <span class="op">=</span> <span class="st">'pairedbed'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span>
<span class="co">#&gt;     chr1   start1     end1  chr2   start2     end2   D   logFC logCPM</span>
<span class="co">#&gt; 1: chr22 18500000 18599999 chr22 24700000 24799999  62  1.1694 9.7256</span>
<span class="co">#&gt; 2: chr22 20200000 20299999 chr22 20300000 20399999   1 -0.5443 6.2774</span>
<span class="co">#&gt; 3: chr22 24400000 24499999 chr22 36300000 36399999 119  1.6664 9.4722</span>
<span class="co">#&gt; 4: chr22 26600000 26699999 chr22 27100000 27199999   5  0.5351 8.9949</span>
<span class="co">#&gt; 5: chr22 28600000 28699999 chr22 39800000 39899999 112 -3.4597 8.0822</span>
<span class="co">#&gt; 6: chr22 30700000 30799999 chr22 33400000 33499999  27 -3.2383 7.1872</span>
<span class="co">#&gt;       p.value      p.adj</span>
<span class="co">#&gt; 1: 5.9373E-05 1.5217E-01</span>
<span class="co">#&gt; 2: 3.4394E-03 1.1167E-01</span>
<span class="co">#&gt; 3: 8.9882E-05 1.0274E-01</span>
<span class="co">#&gt; 4: 1.7285E-03 1.8303E-01</span>
<span class="co">#&gt; 5: 5.1491E-05 1.0274E-01</span>
<span class="co">#&gt; 6: 3.6815E-05 7.5102E-02</span></code></pre></div>
<p>Additionally, you can summarize the regions that were detected as significant at least once by setting <code>return_df = 'bed'</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topDirs.html">topDirs</a></span><span class="op">(</span><span class="va">hicexp1</span>, logfc_cutoff <span class="op">=</span> <span class="fl">0.5</span>, logcpm_cutoff <span class="op">=</span> <span class="fl">0.5</span>, 
                  p.adj_cutoff <span class="op">=</span> <span class="fl">0.2</span>, return_df <span class="op">=</span> <span class="st">'bed'</span>, pval_aggregate <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>
<span class="co">#&gt;      chr    start      end count avgD avgLogFC avgLogCPM   avgP.adj</span>
<span class="co">#&gt; 1: chr22 36300000 36399999     2  117   1.9627    9.0681 1.9318E-01</span>
<span class="co">#&gt; 2: chr22 18500000 18599999     1   62   1.1694    9.7256 1.5217E-01</span>
<span class="co">#&gt; 3: chr22 20200000 20299999     1    1  -0.5443    6.2774 1.1167E-01</span>
<span class="co">#&gt; 4: chr22 20300000 20399999     1    1  -0.5443    6.2774 1.1167E-01</span>
<span class="co">#&gt; 5: chr22 24400000 24499999     1  119   1.6664    9.4722 1.0274E-01</span>
<span class="co">#&gt; 6: chr22 24700000 24799999     1   62   1.1694    9.7256 1.5217E-01</span></code></pre></div>
<p>The resulting table when <code>return_df = 'bed'</code> is used can be input into the following plot function to visualize the p-values of the top differentially interacting regions (DIRs).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_pvals.html">plot_pvals</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Or to visualize the counts of the top DIRs.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_counts.html">plot_counts</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div id="other-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#other-functions" class="anchor"></a>Other functions</h2>
<p>There are several other functions included in <code>multiHiCcompare</code>. <code><a href="../reference/manhattan_hicexp.html">manhattan_hicexp()</a></code> produces a Manhattan plot for the results of a comparison to identify “hotspot” regions of the genome where large numbers of significant differences are found.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/manhattan_hicexp.html">manhattan_hicexp</a></span><span class="op">(</span><span class="va">hicexp1</span>, p.adj_cutoff <span class="op">=</span> <span class="st">"standard"</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>There is also the MD plotting function <code><a href="../reference/MD_hicexp.html">MD_hicexp()</a></code> which will plot MD plots for each unique pair of samples in the <code>hicexp</code> object.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/MD_hicexp.html">MD_hicexp</a></span><span class="op">(</span><span class="va">hicexp1</span>, prow <span class="op">=</span> <span class="fl">2</span>, pcol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>The <code><a href="../reference/MD_composite.html">MD_composite()</a></code> function will plot a composite MD plot of the results of a comparison where the significant differences are highlighted.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/MD_composite.html">MD_composite</a></span><span class="op">(</span><span class="va">hicexp1</span><span class="op">)</span></code></pre></div>
<p><img src="multiHiCcompare_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<pre><code>#&gt; R version 4.0.2 (2020-06-22)
#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)
#&gt; Running under: macOS  10.16
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] multiHiCcompare_1.9.0 BiocStyle_2.16.1     
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;   [1] nlme_3.1-150                bitops_1.0-6               
#&gt;   [3] matrixStats_0.57.0          fs_1.5.0                   
#&gt;   [5] RColorBrewer_1.1-2          rprojroot_2.0.2            
#&gt;   [7] GenomeInfoDb_1.24.2         InteractionSet_1.16.0      
#&gt;   [9] tools_4.0.2                 R6_2.5.0                   
#&gt;  [11] KernSmooth_2.23-18          BiocGenerics_0.34.0        
#&gt;  [13] mgcv_1.8-33                 colorspace_2.0-0           
#&gt;  [15] DNAcopy_1.62.0              gridExtra_2.3              
#&gt;  [17] tidyselect_1.1.0            aggregation_1.0.1          
#&gt;  [19] compiler_4.0.2              textshaping_0.2.1          
#&gt;  [21] Biobase_2.48.0              desc_1.2.0                 
#&gt;  [23] DelayedArray_0.14.1         bookdown_0.21              
#&gt;  [25] scales_1.1.1                pbapply_1.4-3              
#&gt;  [27] pkgdown_1.6.1               systemfonts_0.3.2          
#&gt;  [29] stringr_1.4.0               digest_0.6.27              
#&gt;  [31] Rsamtools_2.4.0             rmarkdown_2.5              
#&gt;  [33] R.utils_2.10.1              XVector_0.28.0             
#&gt;  [35] pkgconfig_2.0.3             htmltools_0.5.0            
#&gt;  [37] parallelly_1.21.0           limma_3.44.3               
#&gt;  [39] rlang_0.4.8                 rstudioapi_0.13            
#&gt;  [41] impute_1.62.0               generics_0.1.0             
#&gt;  [43] gtools_3.8.2                BiocParallel_1.22.0        
#&gt;  [45] dplyr_1.0.2                 R.oo_1.24.0                
#&gt;  [47] RCurl_1.98-1.2              magrittr_2.0.1             
#&gt;  [49] GenomeInfoDbData_1.2.3      qqman_0.1.4                
#&gt;  [51] Matrix_1.2-18               HiCcompare_1.10.0          
#&gt;  [53] Rhdf5lib_1.10.1             Rcpp_1.0.5                 
#&gt;  [55] munsell_0.5.0               S4Vectors_0.26.1           
#&gt;  [57] lifecycle_0.2.0             R.methodsS3_1.8.1          
#&gt;  [59] stringi_1.5.3               CGHbase_1.48.0             
#&gt;  [61] yaml_2.2.1                  edgeR_3.30.3               
#&gt;  [63] MASS_7.3-53                 SummarizedExperiment_1.18.2
#&gt;  [65] zlibbioc_1.34.0             rhdf5_2.32.4               
#&gt;  [67] grid_4.0.2                  parallel_4.0.2             
#&gt;  [69] listenv_0.8.0               crayon_1.3.4               
#&gt;  [71] lattice_0.20-41             Biostrings_2.56.0          
#&gt;  [73] splines_4.0.2               locfit_1.5-9.4             
#&gt;  [75] knitr_1.30                  pillar_1.4.7               
#&gt;  [77] GenomicRanges_1.40.0        CGHcall_2.50.0             
#&gt;  [79] future.apply_1.6.0          codetools_0.2-16           
#&gt;  [81] marray_1.66.0               stats4_4.0.2               
#&gt;  [83] glue_1.4.2                  evaluate_0.14              
#&gt;  [85] calibrate_1.7.7             data.table_1.13.2          
#&gt;  [87] BiocManager_1.30.10         vctrs_0.3.5                
#&gt;  [89] gtable_0.3.0                purrr_0.3.4                
#&gt;  [91] future_1.20.1               assertthat_0.2.1           
#&gt;  [93] QDNAseq_1.24.0              ggplot2_3.3.2              
#&gt;  [95] xfun_0.19                   ragg_0.4.0                 
#&gt;  [97] pheatmap_1.0.12             tibble_3.0.4               
#&gt;  [99] memoise_1.1.0               IRanges_2.22.2             
#&gt; [101] globals_0.13.1              ellipsis_0.3.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Stansfield.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
